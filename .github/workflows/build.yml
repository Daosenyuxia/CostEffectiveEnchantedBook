name: costeffectiveenchantedbook
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    name: costeffectiveenchantedbook
    runs-on: ubuntu-latest
    
    steps:
    # æ­¥éª¤1: æ£€å‡ºä»£ç 
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # æ­¥éª¤2: è®¾ç½® JDK 21
    - name: Set up JDK 21
      uses: actions/setup-java@v3
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: 'gradle'

    # æ­¥éª¤3: æŽˆäºˆ gradlew æ‰§è¡Œæƒé™
    - name: Make gradlew executable
      run: chmod +x gradlew

    # æ­¥éª¤4: æž„å»ºé¡¹ç›®
    - name: Build with Gradle
      run: ./gradlew build

    # æ­¥éª¤5: æµ‹è¯•é¡¹ç›®
    - name: Run tests
      run: ./gradlew test

    # æ­¥éª¤6: ä¸Šä¼ æž„å»ºäº§ç‰©
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: fabric-mod-artifacts
        path: |
          build/libs/*.jar
          build/reports/tests/test/
        retention-days: 7

    # æ­¥éª¤7: ç¼“å­˜æž„å»ºç»“æžœï¼ˆå¯é€‰ï¼‰
    - name: Cache Gradle packages
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-

    # æ­¥éª¤8: ç”Ÿæˆæž„å»ºæ‘˜è¦
    - name: Generate build summary
      run: |
        echo "### ðŸŽ¯ æž„å»ºæ‘˜è¦" >> $GITHUB_STEP_SUMMARY
        echo "- **æž„å»ºçŠ¶æ€**: âœ… æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
        echo "- **Minecraft ç‰ˆæœ¬**: 1.21.8" >> $GITHUB_STEP_SUMMARY
        echo "- **Fabric API ç‰ˆæœ¬**: 0.133.0+1.21.8" >> $GITHUB_STEP_SUMMARY
        echo "- **æž„å»ºæ—¶é—´**: $(date)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“¦ æž„å»ºäº§ç‰©" >> $GITHUB_STEP_SUMMARY
        ls -la build/libs/ >> $GITHUB_STEP_SUMMARY